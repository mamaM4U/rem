name: rem_workspace
publish_to: none

environment:
  sdk: ^3.5.0

workspace:
  - app
  - api_server
  - landing_page_ssr
  - packages/shared

dev_dependencies:
  melos: ^7.3.0

melos:
  name: rem

  scripts:
    # Analyze all packages
    analyze:
      run: melos exec -- dart analyze .
      description: Run dart analyze in all packages

    # Format all packages
    format:
      run: dart format .
      description: Format all Dart files

    # Run tests in all packages
    test:
      run: melos exec -- dart test
      packageFilters:
        dirExists: test
      description: Run tests in all packages

    # Build runner for code generation
    build:runner:
      run: melos exec -- dart run build_runner build --delete-conflicting-outputs
      packageFilters:
        dependsOn: build_runner
      description: Run build_runner in packages that have it

    # Clean all packages
    clean:
      run: melos exec -- flutter clean
      packageFilters:
        flutter: true
      description: Clean all Flutter packages

    # Get dependencies for all packages
    get:
      run: melos exec -- dart pub get
      description: Get dependencies for all packages

    # Run Flutter app
    arona:
      exec: flutter run
      packageFilters:
        scope: arona
      description: Run the Flutter app

    # Run Dart Frog server
    plana:
      exec: dart_frog dev
      packageFilters:
        scope: plana
      description: Run the Dart Frog server

    # Docker commands for Plana
    plana:docker:up:
      exec: docker-compose up -d 2>&1
      packageFilters:
        scope: plana
      description: Start Docker containers for Plana (PostgreSQL)

    plana:docker:down:
      exec: docker-compose down 2>&1
      packageFilters:
        scope: plana
      description: Stop Docker containers for Plana

    plana:docker:logs:
      exec: docker-compose logs -f
      packageFilters:
        scope: plana
      description: View Docker logs for Plana

    plana:docker:restart:
      exec: docker-compose restart 2>&1
      packageFilters:
        scope: plana
      description: Restart Docker containers for Plana

    # Run Jaspr landing page
    arisu:
      exec: jaspr serve
      packageFilters:
        scope: arisu
      description: Run the Jaspr landing page

    # Build Jaspr landing page
    arisu:build:
      exec: jaspr build
      packageFilters:
        scope: arisu
      description: Build the Jaspr landing page for production

    # Docker commands for full stack (root docker-compose)
    docker:up:
      run: docker-compose up -d 2>&1
      description: Start all services (DB + Plana + Arisu)

    docker:down:
      run: docker-compose down 2>&1
      description: Stop all services

    docker:logs:
      run: docker-compose logs -f
      description: View all container logs

    docker:build:
      run: docker-compose build 2>&1
      description: Build all container images

    docker:restart:
      run: docker-compose restart 2>&1
      description: Restart all services
